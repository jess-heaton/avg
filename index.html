<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chatbot Test</title>
</head>
<body>
<script type="text/javascript">
(function() {
    'use strict';
    
    // First, aggressively remove any existing Voiceflow
    function removeExistingVoiceflow() {
        // Remove existing voiceflow elements
        const existingElements = document.querySelectorAll('#voiceflow-chat, [id*="voiceflow"], [class*="voiceflow"]');
        existingElements.forEach(el => el.remove());
        
        // Remove existing scripts
        const existingScripts = document.querySelectorAll('script[src*="voiceflow"], script[src*="cdn.voiceflow"]');
        existingScripts.forEach(script => script.remove());
        
        // Clear any existing voiceflow objects
        if (window.voiceflow) {
            delete window.voiceflow;
        }
    }

    // Remove existing stuff immediately
    removeExistingVoiceflow();

    const styles = `
        /* Hide any existing voiceflow widgets */
        #voiceflow-chat, [id*="voiceflow"]:not(#avantGardeVoiceflowEmbed) { 
            display: none !important; 
            visibility: hidden !important;
            opacity: 0 !important;
        }

        /* Custom button */
        .avant-garde-chat-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #c41e3a 0%, #dc143c 50%, #b22222 100%);
            border: none;
            cursor: pointer;
            box-shadow: 0 8px 32px rgba(196, 30, 58, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999999;
            transition: all 0.3s ease;
        }

        .avant-garde-chat-button:hover {
            transform: scale(1.1);
        }

        /* Shield logo */
        .avant-garde-shield {
            width: 40px;
            height: 40px;
            background-image: url('https://raw.githubusercontent.com/jess-heaton/avg/main/avant-garde-logo.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        /* Desktop widget container */
        .avant-garde-chat-widget-container {
            position: fixed;
            bottom: 120px;
            right: 30px;
            width: 400px;
            height: 650px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px) scale(0.95);
            transition: all 0.4s ease;
            z-index: 999998;
        }

        .avant-garde-chat-widget-container.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        /* Chat content */
        .avant-garde-chat-content {
            height: 100%;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
        }

        /* Close button */
        .avant-garde-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background: #c41e3a;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 1000001;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* MOBILE STYLES - FULL SCREEN TAKEOVER */
        @media (max-width: 767px) {
            .avant-garde-chat-widget-container {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                width: 100vw !important;
                height: 100vh !important;
                border-radius: 0 !important;
                z-index: 2147483647 !important; /* Maximum z-index */
            }

            .avant-garde-chat-content {
                border-radius: 0 !important;
                height: 100vh !important;
                width: 100vw !important;
            }

            .avant-garde-close-btn {
                position: fixed !important;
                top: 20px !important;
                right: 20px !important;
                width: 50px !important;
                height: 50px !important;
                font-size: 24px !important;
                z-index: 2147483647 !important; /* Maximum z-index */
                background: rgba(196, 30, 58, 0.9) !important;
                backdrop-filter: blur(10px);
            }

            /* Hide body scroll when widget open */
            body.widget-open {
                overflow: hidden !important;
                position: fixed !important;
                width: 100% !important;
            }
        }
    `;

    // Inject styles
    const styleSheet = document.createElement('style');
    styleSheet.textContent = styles;
    document.head.appendChild(styleSheet);

    function createWidget() {
        // Create button
        const button = document.createElement('button');
        button.className = 'avant-garde-chat-button';
        button.id = 'avantGardeChatBtn';
        
        const shield = document.createElement('div');
        shield.className = 'avant-garde-shield';
        button.appendChild(shield);

        // Create widget container
        const container = document.createElement('div');
        container.className = 'avant-garde-chat-widget-container';
        container.id = 'avantGardeChatContainer';

        // Create close button
        const closeBtn = document.createElement('button');
        closeBtn.className = 'avant-garde-close-btn';
        closeBtn.innerHTML = 'Ã—';
        closeBtn.id = 'avantGardeCloseBtn';

        // Create content area
        const content = document.createElement('div');
        content.className = 'avant-garde-chat-content';
        content.id = 'avantGardeVoiceflowEmbed';

        container.appendChild(closeBtn);
        container.appendChild(content);

        document.body.appendChild(button);
        document.body.appendChild(container);

        return { button, container, closeBtn, content };
    }

    function initializeEvents(elements) {
        const { button, container, closeBtn } = elements;
        let isOpen = false;

        function toggleWidget() {
            isOpen = !isOpen;
            container.classList.toggle('open', isOpen);
            
            // Mobile: prevent body scroll
            if (window.innerWidth <= 767) {
                document.body.classList.toggle('widget-open', isOpen);
            }
        }

        button.addEventListener('click', toggleWidget);
        closeBtn.addEventListener('click', toggleWidget);

        // Close on outside click (desktop only)
        if (window.innerWidth > 767) {
            document.addEventListener('click', function(e) {
                if (isOpen && !container.contains(e.target) && !button.contains(e.target)) {
                    toggleWidget();
                }
            });
        }

        // ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && isOpen) {
                toggleWidget();
            }
        });
    }

    function loadVoiceflow() {
        const script = document.createElement('script');
        script.src = 'https://cdn.voiceflow.com/widget-next/bundle.mjs';
        script.type = 'text/javascript';
        script.onload = function() {
            if (window.voiceflow && window.voiceflow.chat) {
                window.voiceflow.chat.load({
                    verify: { projectID: '681be03ddbdfd714348146a6' },
                    url: 'https://general-runtime.voiceflow.com',
                    versionID: 'production',
                    voice: {
                        url: "https://runtime-api.voiceflow.com"
                    },
                    render: {
                        mode: 'embedded',
                        target: document.getElementById('avantGardeVoiceflowEmbed')
                    }
                });
            }
        };
        script.onerror = function() {
            console.error('Failed to load Voiceflow');
        };
        document.head.appendChild(script);
    }

    function init() {
        // Remove any existing stuff again
        removeExistingVoiceflow();
        
        // Wait a bit then create our widget
        setTimeout(() => {
            const elements = createWidget();
            initializeEvents(elements);
            loadVoiceflow();
        }, 100);
    }

    // Initialize when ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

    // Also try to clean up any voiceflow that loads after us
    setTimeout(removeExistingVoiceflow, 2000);
    setTimeout(removeExistingVoiceflow, 5000);
})();
</script>
</body>
</html>
